{{ define "text_field" }}
<template id="{{ . }}">
    <div
        x-data="{
            data: initField('{{ . }}'),
            hovering: false,
            active: false,
            remove() {
                removeElement($el);
                removeFieldData(this.data.id);
            },
        }"
        :id="data.id"
        form-field="{{ . }}"
        class="relative rounded"
        @dragstart="active = true"
        @dragend="active = false"
    >
        <div
            :class="{ 'opacity-50': data.hidden, 'grid-cols-[3fr_4fr]': data.layout === 'inline'  }"
            class="grid gap-1 w-full items-center"
            inert
        >
            <div class="flex gap-1 items-center">
                <label
                    x-show="data.includeLabel"
                    x-text="data.label"
                    :for="data.id"
                    class="font-medium select-none"
                ></label>
                <span
                    x-show="data.required"
                    class="leading-4 font-semibold text-rose-500"
                >
                    *
                </span>
            </div>
            {{ if eq . "text" }} {{ template "text_input" }} {{ else if eq . "number" }} {{ template "number_input" }}
            {{ else if eq . "select" }} {{ template "select_input" }} {{ else if eq . "datetime" }} {{ template
            "date_field" }} {{ end }}
            <div x-show="data.description != ''">
                <span x-text="data.description"></span>
            </div>
        </div>
        <div
            class="absolute inset-0 border"
            :class="{ 'border-sky-500': hovering || active, 'border-transparent': !hovering && !active, 'bg-sky-500/20': active }"
            @pointerenter="hovering = !dragging && true"
            @pointerleave="hovering = false"
            @click="active = true; editFieldData($data.data)"
            @click.outside="active = false"
        >
            <div
                x-show="hovering || active"
                class="absolute -left-px bottom-full font-mono flex py-0.5 px-3 gap-3 text-xs bg-sky-500"
            >
                <span class="font-bold italic cursor-default select-none">
                    {{ if eq . "text" }} Text Field {{ else if eq . "number" }} Number Field {{ else if eq . "select" }}
                    Select Field {{ else if eq . "datetime" }} Date Field {{ end }}
                </span>
                <span
                    x-show="data.hidden || data.readonly"
                    x-text="data.hidden ? '[Hidden]' : data.readonly ? '[Readonly]' : ''"
                    class="text-neutral-400 dark:text-white/40"
                ></span>
            </div>
            <div
                x-show="hovering || active"
                class="absolute -right-px bottom-full"
            >
                <div
                    x-data="{ consoleThis() { console.log($el) } }"
                    @pointerdown.stop
                    class="flex gap-1 relative text-white"
                >
                    <div class="bg-sky-500">
                        <button class="w-5 h-5 p-1 cursor-pointer transition hover:bg-sky-600">
                            <svg
                                viewBox="0 0 15 15"
                                class="fill-current [fill-rule:evenodd] [clip-rule:evenodd]"
                            >
                                <path
                                    d="M1 9.50006C1 10.3285 1.67157 11.0001 2.5 11.0001H4L4 10.0001H2.5C2.22386 10.0001 2 9.7762 2 9.50006L2 2.50006C2 2.22392 2.22386 2.00006 2.5 2.00006L9.5 2.00006C9.77614 2.00006 10 2.22392 10 2.50006V4.00002H5.5C4.67158 4.00002 4 4.67159 4 5.50002V12.5C4 13.3284 4.67158 14 5.5 14H12.5C13.3284 14 14 13.3284 14 12.5V5.50002C14 4.67159 13.3284 4.00002 12.5 4.00002H11V2.50006C11 1.67163 10.3284 1.00006 9.5 1.00006H2.5C1.67157 1.00006 1 1.67163 1 2.50006V9.50006ZM5 5.50002C5 5.22388 5.22386 5.00002 5.5 5.00002H12.5C12.7761 5.00002 13 5.22388 13 5.50002V12.5C13 12.7762 12.7761 13 12.5 13H5.5C5.22386 13 5 12.7762 5 12.5V5.50002Z"
                                />
                            </svg>
                        </button>
                    </div>
                    <div
                        x-data="{ deleteDialogOpen: false }"
                        class="bg-sky-500"
                    >
                        <button
                            class="w-5 h-5 p-1 cursor-pointer transition relative hover:bg-sky-600"
                            @click="deleteDialogOpen = true"
                        >
                            <svg
                                viewBox="0 0 1024 1024"
                                class="fill-current [fill-rule:evenodd]"
                            >
                                <path
                                    d="M799.855 166.312c.023.007.043.018.084.059l57.69 57.69c.041.041.052.06.059.084a.118.118 0 0 1 0 .069c-.007.023-.018.042-.059.083L569.926 512l287.703 287.703c.041.04.052.06.059.083a.118.118 0 0 1 0 .07c-.007.022-.018.042-.059.083l-57.69 57.69c-.041.041-.06.052-.084.059a.118.118 0 0 1-.069 0c-.023-.007-.042-.018-.083-.059L512 569.926 224.297 857.629c-.04.041-.06.052-.083.059a.118.118 0 0 1-.07 0c-.022-.007-.042-.018-.083-.059l-57.69-57.69c-.041-.041-.052-.06-.059-.084a.118.118 0 0 1 0-.069c.007-.023.018-.042.059-.083L454.073 512 166.371 224.297c-.041-.04-.052-.06-.059-.083a.118.118 0 0 1 0-.07c.007-.022.018-.042.059-.083l57.69-57.69c.041-.041.06-.052.084-.059a.118.118 0 0 1 .069 0c.023.007.042.018.083.059L512 454.073l287.703-287.702c.04-.041.06-.052.083-.059a.118.118 0 0 1 .07 0Z"
                                />
                            </svg>
                        </button>
                        <div
                            x-show="deleteDialogOpen"
                            x-transition
                            class="grid gap-4 items-center w-max p-4 absolute top-0 -right-0.5 z-50 text-sm shadow-md rounded-md bg-white border border-neutral-200 dark:bg-aux-dark dark:border-aux-dark"
                            @click.window.outside="deleteDialogOpen = false;"
                            @keyup.escape.prevent="deleteDialogOpen = false"
                        >
                            <h1>Are you sure you want to delete this field?</h1>
                            <div class="flex gap-2 justify-self-end">
                                <button
                                    @click.self="remove(); consoleThis(); deleteDialogOpen = false;"
                                    class="px-3 py-1.5 rounded transition-all text-white bg-rose-500 hover:bg-rose-600 outline-rose-300/60 dark:bg-opacity-80 dark:hover:bg-opacity-70"
                                >
                                    Delete
                                </button>
                                <button
                                    @click="deleteDialogOpen = false;"
                                    class="px-3 py-1.5 rounded border transition-all border-neutral-200 text-neutral-600 hover:bg-neutral-100 dark:text-white/80 dark:bg-aux-dark dark:border-[#555] dark:hover:text-white/90 dark:hover:bg-[#3e3e3e]"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
{{ end }} {{ define "text_input" }}
<input
    :id="data.id"
    :value="data.defaultValue ? data.defaultValue : ''"
    :placeholder="data.placeholder"
    :readonly="data.readonly || data.hidden"
    @change="$el.value = data.defaultValue ? data.defaultValue : ''"
    type="text"
/>
{{ end }} {{ define "number_input" }}
<input
    :id="data.id"
    :value="data.defaultValue ? data.defaultValue : ''"
    :placeholder="data.placeholder"
    :readonly="data.readonly || data.hidden"
    @change="$el.value = data.defaultValue ? data.defaultValue : ''"
    type="number"
/>
{{ end }} {{ define "select_input" }}
<select
    :id="data.id"
    :readonly="data.readonly || data.hidden"
    @change="$el.value = data.defaultValue ? data.defaultValue : ''"
></select>
{{ end }}
