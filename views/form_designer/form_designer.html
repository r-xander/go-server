<!--
    https://www.behance.net/gallery/150989275/Form-Builder?tracking_source=search_projects|form+builder&l=142
    https://www.behance.net/gallery/67313351/CallVU-Form-Builder?tracking_source=search_projects|form+builder&l=67
    https://docs.servicenow.com/bundle/washingtondc-platform-administration/page/administer/form-administration/concept/c_FormDesign.html
    https://dribbble.com/shots/14746133-Liferay-DXP-Dark-Mode
    https://dribbble.com/shots/22947219-Form-builder-UI
-->

{{ define "title" }} Form Designer {{ end }} {{ define "scripts" }}
<script
    src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"
    defer
></script>
<script
    src="https://cdn.jsdelivr.net/npm/@alpinejs/anchor@3.x.x/dist/cdn.min.js"
    defer
></script>
<script
    src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    defer
></script>
<script
    src="/js/form_designer.js"
    type="text/javascript"
    charset="utf-8"
></script>
{{ end }} {{ define "body" }}
<main
    x-data="formData"
    class="relative flex h-full w-full overflow-y-hidden dark:bg-[#0e0e0e]"
    @dragstart="showNewFieldDropZone = addingField && true"
    @dragend="showNewFieldDropZone = false"
    @change="$event instanceof CustomEvent && processFieldMove($event)"
    @start="movingField = true; toSection = $event.to;"
    @end="movingField = false; toSection = null;"
    @pointerdown="setActiveElement(null)"
>
    <div
        @pointerdown.stop
        class="relative z-10 w-[22rem] shrink-0 grow-0 font-semibold select-none transition-all dark:bg-card-dark"
    >
        <div class="absolute inset-0">
            <section class="p-4 text-sm">
                <h3 class="mb-4 text-[#828282] dark:text-[#c3c3c3]">Fields</h3>
                <div
                    id="action-element-container"
                    class="grid grid-cols-2 gap-3 text-indigo-900/70 dark:text-white/70"
                    @pointerdown="setActiveElement(null)"
                >
                    <div
                        class="flex gap-4 px-4 py-2 items-center rounded origin-center transition-all duration-100 bg-white border border-neutral-200/65 dark:bg-aux-dark dark:border-none hover:[scale:101%] hover:[translate:0_-2px] hover:[box-shadow:0_2px_#00000026] hover:text-indigo-900 hover:dark:text-white"
                        dd-template="text"
                        draggable="true"
                        @dragstart="addingField = true; dragStart($event)"
                        @dragend="addingField = false"
                    >
                        <svg
                            viewBox="0 0 16 15"
                            class="w-5 min-w-5 fill-current"
                        >
                            <path
                                d="M1.226 10.88H0l2.056-6.26h1.42l2.047 6.26h-1.29l-.48-1.61H1.707l-.48 1.61ZM2.76 5.818h-.054l-.75 2.532H3.51zm3.217 5.062V4.62h2.56c1.09 0 1.808.582 1.808 1.54 0 .762-.444 1.22-1.05 1.372v.055c.736.074 1.365.587 1.365 1.528 0 1.119-.89 1.766-2.133 1.766zM7.18 5.55v1.675h.8c.812 0 1.171-.308 1.171-.853 0-.51-.328-.822-.898-.822zm0 2.537V9.95h.903c.951 0 1.342-.312 1.342-.909 0-.591-.382-.954-1.095-.954zm5.089-.711v.775c0 1.156.49 1.803 1.347 1.803.705 0 1.163-.454 1.212-1.096H16v.12C15.942 10.173 14.95 11 13.607 11c-1.648 0-2.573-1.073-2.573-2.849v-.78c0-1.775.934-2.871 2.573-2.871 1.347 0 2.34.849 2.393 2.087v.115h-1.172c-.05-.665-.516-1.156-1.212-1.156-.849 0-1.347.67-1.347 1.83"
                            />
                        </svg>
                        <span>Text</span>
                    </div>
                    <div
                        class="flex gap-4 px-4 py-2 items-center rounded origin-center transition-all duration-100 bg-white border border-neutral-200/65 dark:bg-aux-dark dark:border-none hover:[scale:101%] hover:[translate:0_-2px] hover:[box-shadow:0_2px_#00000026] hover:text-indigo-900 hover:dark:text-white"
                        dd-template="number"
                        draggable="true"
                        @dragstart="addingField = true; dragStart($event)"
                        @dragend="addingField = false"
                    >
                        <svg
                            viewBox="0 0 16 15"
                            class="w-5 min-w-5 fill-current"
                        >
                            <path
                                d="M2.873 11.297V4.142H1.699L0 5.379v1.137l1.64-1.18h.06v5.961zm3.213-5.09v-.063c0-.618.44-1.169 1.196-1.169.676 0 1.174.44 1.174 1.106 0 .624-.42 1.101-.807 1.526L4.99 10.553v.744h4.78v-.99H6.643v-.069L8.41 8.252c.65-.724 1.237-1.332 1.237-2.27C9.646 4.849 8.723 4 7.308 4c-1.573 0-2.36 1.064-2.36 2.15v.057zm6.559 1.883h.786c.823 0 1.374.481 1.379 1.179.01.707-.55 1.216-1.421 1.21-.77-.005-1.326-.419-1.379-.953h-1.095c.042 1.053.938 1.918 2.464 1.918 1.478 0 2.642-.839 2.62-2.144-.02-1.143-.922-1.651-1.551-1.714v-.063c.535-.09 1.347-.66 1.326-1.678-.026-1.053-.933-1.855-2.359-1.845-1.5.005-2.317.88-2.348 1.898h1.116c.032-.498.498-.944 1.206-.944.703 0 1.206.435 1.206 1.07.005.64-.504 1.106-1.2 1.106h-.75z"
                            />
                        </svg>
                        <span>Number</span>
                    </div>
                    <div
                        class="flex gap-4 px-4 py-2 items-center rounded origin-center transition-all duration-100 bg-white border border-neutral-200/65 dark:bg-aux-dark dark:border-none hover:[scale:101%] hover:[translate:0_-2px] hover:[box-shadow:0_2px_#00000026] hover:text-indigo-900 hover:dark:text-white"
                        dd-template="select"
                        draggable="true"
                        @dragstart="addingField = true; dragStart($event)"
                        @dragend="addingField = false"
                    >
                        <svg
                            viewBox="0 0 16 15"
                            class="w-5 min-w-5 fill-current"
                        >
                            <path
                                fill-rule="evenodd"
                                d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"
                            />
                        </svg>
                        <span>Select</span>
                    </div>
                    <div
                        class="flex gap-4 px-4 py-2 items-center rounded origin-center transition-all duration-100 bg-white border border-neutral-200/65 dark:bg-aux-dark dark:border-none hover:[scale:101%] hover:[translate:0_-2px] hover:[box-shadow:0_2px_#00000026] hover:text-indigo-900 hover:dark:text-white"
                        dd-template="datetime"
                        draggable="true"
                        @dragstart="addingField = true; dragStart($event)"
                        @dragend="addingField = false"
                    >
                        <svg
                            viewBox="-1 -1 24 24"
                            class="w-5 min-w-5 fill-current"
                        >
                            <path
                                d="m4 4h3l0-1c0-1 1-1 1-1 1 0 1 1 1 1l0 1 4 0 0-1c0-1 1-1 1-1 1 0 1 1 1 1l0 1 3 0c1 0 2 1 2 2l0 12c0 1-1 2-2 2l-14 0c-1 0-2-1-2-2l0-12c0-1 1-2 2-2m1 5 12 0c1 0 1-1 1-1l0-1c0 0 0-1-1-1l-12 0c-1 0-1 1-1 1l0 1c0 0 0 1 1 1m0 9 12 0c1 0 1-1 1-1l0-5c0 0 0-1-1-1l-12 0c-1 0-1 1-1 1l0 5c0 0 0 1 1 1"
                            />
                        </svg>
                        <span>Date</span>
                    </div>
                </div>
            </section>
            <section class="p-4 text-sm">
                <h3 class="mb-4 text-[#828282] dark:text-[#c3c3c3]">Layout</h3>
                <div></div>
            </section>
            <section class="p-4 text-sm">
                <h3 class="mb-4 text-[#828282] dark:text-[#c3c3c3]">Components</h3>
                <div></div>
            </section>
            <div
                x-data="{
                    addSectionElement(e) {
                        const formContainer = document.getElementById('form_container');
                        const sectionTemplate = document.getElementById('section-template');
                        const sectionDocFrag = sectionTemplate.content.cloneNode(true);
                        const section = sectionDocFrag.firstElementChild;
                        const newSection = formContainer.insertAdjacentElement('beforeend', section);

                        transition(section);

                        const container = newSection.querySelector('[data-section]');
                        let sortable = new Sortable(container, containerSortableOptions);

                        setTimeout(() => newSection.scrollIntoView({ behavior: 'smooth', block: 'center' }), 200);
                    }
                }"
                class="absolute -right-12 top-4 shadow-md rounded-md overflow-hidden bg-white dark:bg-card-dark"
            >
                <button class="flex items-center justify-center h-8 w-8 hover:bg-neutral-200 dark:hover:bg-aux-dark">
                    <svg
                        class="inline-block h-3 overflow-visible fill-current"
                        viewBox="0 0 576 512"
                    >
                        <path
                            d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"
                        ></path>
                    </svg>
                </button>
                <button class="flex items-center justify-center h-8 w-8 hover:bg-neutral-200 dark:hover:bg-aux-dark">
                    <svg
                        class="inline-block h-3 overflow-visible fill-current"
                        viewBox="0 0 576 512"
                    >
                        <path
                            d="M288 144a110.94 110.94 0 0 0-31.24 5 55.4 55.4 0 0 1 7.24 27 56 56 0 0 1-56 56 55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"
                        ></path>
                    </svg>
                </button>
                <button
                    @click="addSectionElement"
                    class="flex items-center justify-center h-8 w-8 hover:bg-neutral-200 dark:hover:bg-aux-dark"
                >
                    <svg
                        class="inline-block h-3 overflow-visible fill-current"
                        viewBox="0 0 448 512"
                    >
                        <path
                            d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"
                        ></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    <div class="flex-1 min-w-[26rem] grid grid-rows-[max-content_1fr] relative">
        <div
            class="absolute inset-0 w-full py-8 pl-16 pr-12 overflow-auto [scrollbar-gutter:stable] shadow-[0_0_10px_0_inset_#00000026] bg-[#f1f5f9] dark:bg-inherit"
        >
            <div
                id="form_container"
                class="@container/form relative grid max-w-5xl min-w-96 mx-auto text-sm"
                :style="`width:${previewFull ? '100%' : previewWidth + 'px'}`"
            ></div>
        </div>
    </div>
    <div
        class="relative z-10 w-[22rem] font-semibold select-none overflow-hidden dark:bg-card-dark"
        @pointerdown.stop
    >
        <div
            x-data="{ tab: 1 }"
            class="absolute inset-0"
        >
            <div
                class="flex items-center h-10 text-sm text-[#929292] bg-[#f1f5f9] divide-x dark:bg-aux-dark dark:text-[#b5b5b5]"
            >
                <button
                    @click="tab = 1"
                    class="flex-1 h-full border-[#e2e8f0] dark:border-[#454545]"
                    :class="{ 'bg-white text-neutral-600 dark:bg-card-dark dark:text-white': tab === 1, 'border-b': tab !== 1 }"
                >
                    Settings
                </button>
                <button
                    @click="tab = 2"
                    class="flex-1 h-full border-[#e2e8f0] dark:border-[#454545]"
                    :class="{ 'bg-white text-neutral-600 dark:bg-card-dark dark:text-white': tab === 2, 'border-b': tab !== 2 }"
                >
                    Rules
                </button>
                <button
                    @click="tab = 3"
                    class="flex-1 h-full border-[#e2e8f0] dark:border-[#454545]"
                    :class="{ 'bg-white text-neutral-600 dark:bg-card-dark dark:text-white': tab === 3, 'border-b': tab !== 3 }"
                >
                    Work Flow
                </button>
            </div>
            <div class="absolute top-10 bottom-0 left-0 right-0">
                <div
                    x-show="tab === 1"
                    class="flex flex-col p-4 pt-8 gap-4 text-sm"
                >
                    <div class="grid grid-cols-[5fr_7fr] gap-1 items-center">
                        <label for="form-name">Form</label>
                        <input
                            x-model="formName"
                            type="text"
                            name="form-name"
                            id="form-name"
                            class="w-full"
                        />
                    </div>
                    <div class="grid grid-cols-[5fr_7fr] gap-2 items-center">
                        <label for="preview-width">Preview Width</label>
                        <div class="flex w-full gap-4">
                            <label
                                for="preview-full"
                                class="flex items-center gap-2 h-9"
                            >
                                <input
                                    x-model="previewFull"
                                    type="checkbox"
                                    name="preview-full"
                                    id="preview-full"
                                />Full
                            </label>
                            <div
                                x-show="!previewFull"
                                class="flex items-center has-[:focus]:ring-2 has-[:focus]:ring-sky-500 transition-all rounded dark:bg-[#363636]"
                            >
                                <input
                                    x-model="previewWidth"
                                    type="text"
                                    name="preview-width"
                                    id="preview-width"
                                    class="w-full"
                                    style="box-shadow: unset; border: unset"
                                />
                                <span class="pr-2">px</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div
                    x-show="tab === 2"
                    class="flex flex-col p-4 gap-4 text-sm"
                ></div>
                <div
                    x-show="tab === 3"
                    class="flex flex-col p-4 gap-4 text-sm"
                ></div>
            </div>
        </div>
        <div
            class="absolute inset-0 transition-all bg-white dark:bg-card-dark"
            :class="{ 'translate-x-full': !editModalOpen }"
            :inert="!editModalOpen"
        >
            <div class="relative h-20 border-b border-neutral-200 dark:border-aux-dark">
                <button
                    @click="editModalOpen = false; activeElementId = null"
                    class="p-3 absolute transition text-neutral-500 hover:text-opacity-70 dark:text-neutral-300"
                >
                    <svg
                        viewBox="0 0 1024 1024"
                        class="w-4 h-4 fill-current [fill-rule:evenodd]"
                    >
                        <path
                            d="M799.855 166.312c.023.007.043.018.084.059l57.69 57.69c.041.041.052.06.059.084a.118.118 0 0 1 0 .069c-.007.023-.018.042-.059.083L569.926 512l287.703 287.703c.041.04.052.06.059.083a.118.118 0 0 1 0 .07c-.007.022-.018.042-.059.083l-57.69 57.69c-.041.041-.06.052-.084.059a.118.118 0 0 1-.069 0c-.023-.007-.042-.018-.083-.059L512 569.926 224.297 857.629c-.04.041-.06.052-.083.059a.118.118 0 0 1-.07 0c-.022-.007-.042-.018-.083-.059l-57.69-57.69c-.041-.041-.052-.06-.059-.084a.118.118 0 0 1 0-.069c.007-.023.018-.042.059-.083L454.073 512 166.371 224.297c-.041-.04-.052-.06-.059-.083a.118.118 0 0 1 0-.07c.007-.022.018-.042.059-.083l57.69-57.69c.041-.041.06-.052.084-.059a.118.118 0 0 1 .069 0c.023.007.042.018.083.059L512 454.073l287.703-287.702c.04-.041.06-.052.083-.059a.118.118 0 0 1 .07 0Z"
                        ></path>
                    </svg>
                </button>
                <div class="p-3 text-center">Field Settings</div>
                <div class="grid grid-cols-3 items-center justify-around pb-2 text-sm">
                    <button>Properties</button>
                    <button>States</button>
                    <button>Rules</button>
                </div>
            </div>
            <div
                id="field-details"
                class="absolute top-20 bottom-0 overflow-y-auto"
            >
                <div class="flex flex-col p-4 gap-4 text-sm">
                    <div class="grid grid-cols-[5fr_7fr] gap-1">
                        <label for="label">ID</label>
                        <input
                            :value="editData.id"
                            type="text"
                            name="id"
                            id="id"
                            disabled
                        />
                    </div>
                    <label
                        for="required"
                        class="flex items-center gap-3"
                    >
                        <input
                            x-model="editData.required"
                            type="checkbox"
                            name="required"
                            id="required"
                        />Required
                    </label>
                    <label
                        for="readonly"
                        class="flex items-center gap-3"
                    >
                        <input
                            x-model="editData.readonly"
                            type="checkbox"
                            name="readonly"
                            id="readonly"
                        />Read Only
                    </label>
                    <label
                        for="includeLabel"
                        class="flex items-center gap-3"
                    >
                        <input
                            x-model="editData.includeLabel"
                            type="checkbox"
                            name="includeLabel"
                            id="includeLabel"
                        />Include Label
                    </label>
                    <div class="grid grid-cols-[5fr_7fr] gap-1">
                        <label for="label">Label</label>
                        <input
                            x-model="editData.label"
                            type="text"
                            name="label"
                            id="label"
                            placeholder="Label..."
                            :disabled="!editData.includeLabel"
                        />
                    </div>
                    <div class="grid grid-cols-[5fr_7fr] gap-1">
                        <label for="placeholder">Placeholder</label>
                        <input
                            x-model="editData.placeholder"
                            type="text"
                            name="placeholder"
                            id="placeholder"
                            placeholder="Placeholder..."
                        />
                    </div>
                    <div class="grid grid-cols-[5fr_7fr] gap-1">
                        <label for="default">Default</label>
                        <input
                            x-model="editData.defaultValue"
                            type="text"
                            name="default"
                            id="default"
                            placeholder="Default..."
                        />
                    </div>
                    <!-- <div class="flex gap-4"> -->
                    <div class="grid grid-cols-[5fr_7fr] gap-1">
                        <label for="minlength">Minimum Length</label>
                        <input
                            x-model="editData.minLenth"
                            class="min-w-0"
                            type="number"
                            name="minlength"
                            id="minlength"
                            placeholder="Min length..."
                        />
                    </div>
                    <div class="grid grid-cols-[5fr_7fr] gap-1">
                        <label for="maxlength">Minimum Length</label>
                        <input
                            x-model="editData.maxLength"
                            class="min-w-0"
                            type="number"
                            name="maxlength"
                            id="maxlength"
                            placeholder="Max length..."
                        />
                    </div>
                    <!-- </div> -->
                    <div class="grid grid-cols-[5fr_7fr] gap-1">
                        <label for="layout">Layout</label>
                        <select
                            x-model="editData.layout"
                            type="text"
                            name="layout"
                            id="layout"
                        >
                            <option value="inline">Inline</option>
                            <option value="block">Block</option>
                        </select>
                    </div>
                    <div class="grid gap-1">
                        <label for="description">Description</label>
                        <textarea
                            x-model="editData.description"
                            rows="3"
                            name="description"
                            id="description"
                            placeholder="Description..."
                        ></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{ template "text_field_edit" }}
</main>
{{ template "text_field" "text" }} {{ template "text_field" "number" }} {{ template "text_field" "select" }} {{ template
"text_field" "datetime" }}{{ template "section" }} {{ end }}
